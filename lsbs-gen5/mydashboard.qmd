--- 
title: "대구관련 시각화 프로젝트"
author: "6조"
format: dashboard
--- 

```{python}
import pandas as pd
import plotly.express as px


# 1) 지역 코드-이름 매핑 딕셔너리
code_to_name = {
    "1100": "서울특별시",
    "1200": "부산광역시",
    "2200": "대구광역시",
    "2300": "인천광역시",
    "2400": "광주광역시",
    "2500": "대전광역시",
    "2600": "울산광역시",
    "2700": "세종특별자치시",
    "1300": "경기도",
    "1400": "강원특별자치도",
    "1500": "충청북도",
    "1600": "충청남도",
    "1700": "전북특별자치도",
    "1800": "전라남도",
    "1900": "경상북도",
    "2000": "경상남도",
    "2100": "제주특별자치도"
}

# 2) CSV 로드
df2 = pd.read_csv("./data/10_24_stt.csv", encoding='cp949')

# 3) 필터링: 2024년 + 어린이사고
df_f = df2[(df2["연도"] == 2024) & (df2["대상사고 구분명"] == "어린이사고")].copy()

# 4) 지역별 사고건수 합계
region_sum = df_f.groupby("법정동코드", as_index=False)["사고건수"].sum()
region_sum["법정동코드"] = region_sum["법정동코드"].astype(str)

# 5) 수도권(1100, 1300) 제외
mask_non_capital = ~region_sum["법정동코드"].isin(["1100", "1300"])
region_non_capital = region_sum[mask_non_capital]

# 6) Top 5 추출
top5 = region_non_capital.nlargest(5, "사고건수").sort_values("사고건수", ascending=False)

# 7) 코드 → 이름 매핑
top5["지역명"] = top5["법정동코드"].map(code_to_name)

# 8) 시각화
fig = px.bar(
    top5,
    x="지역명",
    y="사고건수",
    color="사고건수",
    color_continuous_scale="Blues",
    labels={"지역명": "지역", "사고건수": "사고건수(건)"},
    title="2024년 어린이 사고건수 Top 5 (비수도권)",
    range_y=[300, top5["사고건수"].max() + 50],   # ← 여기서 바로 설정
)

# 텍스트와 포맷/위치는 업데이트로
fig.update_traces(
    text=top5["사고건수"],
    texttemplate="%{text:,}",
    textposition="outside"
)
fig.update_yaxes(tickformat=",")

```


```{python}
import pandas as pd
import plotly.express as px

# 데이터 불러오기
df = pd.read_csv("./data/12_23_schoolzone.csv", encoding='cp949')

# 대구광역시, 대구시로 시작하는 경우만 필터링
df_daegu = df[df['시도시군구명'].str.match(r'^(대구광역시|대구시)', na=False)]

# 지역별 평균 사상자수 계산
avg_casualties = df_daegu.groupby('지점명', as_index=False)['사상자수'].mean()

# 산점도 시각화
fig = px.scatter(
    avg_casualties,
    x="지점명",
    y="사상자수",
    size="사상자수",        # 사상자수에 따라 점 크기 조절
    color="사상자수",       # 사상자수에 따라 색상 조절
    title="대구시 스쿨존 교통사고 지역별 사상자수",
    hover_data=["사상자수"]
)

# X축 레이블이 겹치지 않도록 회전
fig.update_layout(xaxis_tickangle=-45)
```

